# LandRunner IMU�f�[�^�L�^�t���[�iGlassBridge�����Łj

## ?? �����x���A�[�L�e�N�`���}

```
������������������������������������������������������������������������������������������������������������������������
��         LandRunner WPF Application                       ��
������������������������������������������������������������������������������������������������������������������������
                        ��
        ������������������������������������������������������������������
        ��               ��               ��
        ��               ��               ��
    ����������������������  ������������������������  ��������������������������������
    ��MainWnd  ��  ��ViewModels��  ��DebugLogger   ��
    �� (XAML)  ��  ��(Logic)   ��  ��(File Output) ��
    ����������������������  ������������������������  ��������������������������������
         ��            ��               ��
         ������������������������������������������������������������
                      ��
         ����������������������������������������������������������
         ��  GlassBridge Library      ��
         ��  (ImuDeviceManager)       ��
         ����������������������������������������������������������
                  ��         ��
         ������������������������  ����������������������������������
         ��HID Comm  ��  ��Recording      ��
         ��(USB)     ��  ��(JSON Lines)   ��
         ������������������������  ����������������������������������
              ��             ��
         ����������������������������������������������������
         ��  imu_data_<ts>.jsonl   ��
         ��  (��������)             ��
         ����������������������������������������������������
```

## ?? IMU�f�[�^�L�^�t���[�i�V�[�P���X�}�j

```
���[�U�[         LandRunner         GlassBridge         �t�@�C���V�X�e��
  ��                 ��                   ��                     ��
  ��  [Connect]      ��                   ��                     ��
  ��������������������������������������                   ��                     ��
  ��                 ��                   ��                     ��
  ��                 �� ConnectAndRecord  ��                     ��
  ��                 ������������������������������������������                     ��
  ��                 ��                   ��                     ��
  ��                 ��                   �� Open HID Device     ��
  ��                 ��                   ����������������������������������������������
  ��                 ��                   �� (VITURE Luma)       ��
  ��                 ��                   ��                     ��
  ��                 ��                   �� Create Recording    ��
  ��                 ��                   ����������������������������������������������
  ��                 ��                   �� (imu_data_*.jsonl)  ��
  ��                 ��  ? Connected      ��                     ��
  ��                 ������������������������������������������                     ��
  ��  ? Ready        ��                   ��                     ��
  ��������������������������������������                   ��                     ��
  ��                 ��                   ��                     ��
  ���� (??? ?? ??)                   ��                     ��
  ��                 �� GetImuDataStream()��                     ��
  ��                 ������������������������������������������                     ��
  ��                 ��                   ��                     ��
  ��                 ��                   ��  Read Sensor Data   ��
  ��                 ��                   ����������������������������������������������
  ��                 ��                   �� (Euler, Quaternion) ��
  ��                 ��                   ��                     ��
  ��                 �� ImuData #1        ��                     ��
  ��                 ������������������������������������������  Auto-Record JSON   ��
  ��                 ��                   ����������������������������������������������
  ��  ?? Display     ��                   ��                     ��
  ��������������������������������������                   ��                     ��
  ��                 ��                   ��                     ��
  ��                 �� ImuData #2        ��                     ��
  ��                 ������������������������������������������  Auto-Record JSON   ��
  ��  ?? Display     ��                   ����������������������������������������������
  ��������������������������������������                   ��                     ��
  ��                 ��                   ��                     ��
  ��                 ��  (�p��...)          ��                     ��
  ��                 ��                   ��                     ��
  ��  [Disconnect]   ��                   ��                     ��
  ��������������������������������������                   ��                     ��
  ��                 ��                   ��                     ��
  ��                 �� Finalize Recording��                     ��
  ��                 ������������������������������������������                     ��
  ��                 ��                   ��                     ��
  ��                 ��                   �� Close File/HID      ��
  ��                 ��                   ����������������������������������������������
  ��                 ��                   �� (Flush JSON Lines)  ��
  ��                 ��  ? Done           ��                     ��
  ��                 ������������������������������������������                     ��
  ��  ? Disconnected ��                   ��                     ��
  ��������������������������������������                   ��                     ��
  ��                 ��                   ��                     ��
```

## ?? �t�@�C���o�͍\��

```
%AppData%/LandRunner/
��
���� debug_20260126_214611.log
��  ���� [2026-01-26 21:46:11.110] ImuLogger initialized
��  ���� [2026-01-26 21:46:11.111] Debug log: C:\Users\...\debug_20260126_214611.log
��  ���� [2026-01-26 21:46:11.112] Recording IMU data to: C:\Users\...\LandRunner
��  ���� [2026-01-26 21:46:12.200] Starting device connection with GlassBridge recording
��  ���� [2026-01-26 21:46:12.500] Successfully connected to device
��  ���� [2026-01-26 21:46:12.501] Recording IMU data to: C:\Users\...\LandRunner
��  ���� [2026-01-26 21:46:20.000] Device disconnected
��
���� imu_data_20260126_214611.jsonl
   ���� {"Timestamp":12345,"MessageCounter":100,"Quaternion":{...},"EulerAngles":{...}}
   ���� {"Timestamp":12350,"MessageCounter":101,"Quaternion":{...},"EulerAngles":{...}}
   ���� ...
```

## ?? �X���b�h�Z�[�t�ȏ����t���[

```
Main Thread              Worker Thread (Streaming)
    ��                              ��
    ���� DebugLogger                 ��
    ��  ���� lock()                   ��
    ��     ���� LogDebug()            ��
    ��        ���� unlock()           ��
    ��                              ��
    ��                    ��������������������������������������������
    ��                    ��         ��          ��
    ��                    ��         ��          ��
    ��              Thread 1    Thread 2   Thread 3
    ��              (Recv #1)  (Recv #2)  (Display)
    ��                ��         ��          ��
    ��                ���� lock() ����         ��
    ��                ��  LogImu  ��         ��
    ��                ��  Flush   ��         ��
    ��                ���� unlock()����         ��
    ��                ��          ���������������������� Update UI
    ��                ��          ��
    ��                ��          ���� lock() ����
    ��                ��          ��  LogImu  ��
    ��                ��          ��  Flush   ��
    ��                ��          ���� unlock()����
    ��                ��                     ��
    ��                                      ��
    ��                            imu_data_*.jsonl
    ��                            (�f�B�X�N��������)
    ��
    �� [Disconnect]
    ��     ��
    ��     ���� cancel token
    ��        ��
    ��        ���� DebugLogger.Dispose()
    ��           ���� Flush & Close all files
    ��
    ��
```

## ?? �f�[�^�t���[�iGlassBridge�L�^�@�\�j

```
1??  �ڑ��t�F�[�Y

    ConnectAndRecordAsync(outputDirectory)
         ��
         ������ RecordingHidStreamProvider ����
             ���� outputDirectory ��ݒ�
             ���� HID �X�g���[�� = �L�^���b�p�[

2??  �X�g���[�~���O�t�F�[�Y

    GetImuDataStreamAsync()
         ��
         ���� VITURE Luma �� HID �p�P�b�g��M
         ��
         ���� ImuData �p�[�X
         ��
         ���� JSON Lines �t�H�[�}�b�g
         ��  ���� {"Timestamp":...,"MessageCounter":...,"Quaternion":{...},"EulerAngles":{...}}
         ��
         ���� �t�@�C���������݁i�����j
         ��  ���� imu_data_<timestamp>.jsonl �ɒǉ�
         ��
         ���� LandRunner �ɕԋp
            ���� UI�X�V & DebugLogger.LogDebug()

3??  �I���t�F�[�Y

    device.DisposeAsync()
         ��
         ���� RecordingHidStreamProvider.FinalizeRecordingAsync()
            ���� JSON Lines �t�@�C�� Flush
            ���� HID �X�g���[�� Close
            ���� �t�@�C���n���h�� Release

```

## ? ���P�_�i���łƂ̔�r�j

| ���� | ���� | �V�ŁiGlassBridge�����j |
|------|------|----------------------|
| **IMU�f�[�^�L�^** | �蓮�iCSV�`���j | �����iJSON Lines�j |
| **DebugLogger�Ӗ�** | 1. IMU�L�^ + 2. ���O | ���O�̂� |
| **GlassBridge���p** | �ڑ��̂� | �ڑ� + �L�^ + �Đ� |
| **�R�[�h��** | �����iCSV�o�̓��W�b�N�j | ���Ȃ��i�V���v���j |
| **�W����** | �Ǝ��`�� | JSON Lines�W�� |
| **�Đ��@�\** | �Ȃ� | `ConnectFromRecordingAsync()` �ŉ\ |

---

**�݌v�X�V��**: 2026�N01��26��
**�X�e�[�^�X**: ? GlassBridge�����łƂ��Ċ���
